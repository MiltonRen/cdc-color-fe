<!DOCTYPE html>
<html lang="en">
<head>
  <title>CDC Color Picker</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'custom-bg': '#242424'
          },
          keyframes: {
            fade_in: {
              '0%':   { opacity: 0 },
              '25%':   { opacity: 0 },
              '100%': { opacity: 1 },
            },
          },
          animation: {
            'fade-in': 'fade_in 2s ease-out',
          }
        }
      }
    }
  </script>
</head>

<style>
  body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: white;
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
  }

  .controls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
  }

  #colorPicker {
      width: 80px;
      height: 40px;
      padding: 0;
  }

  .selected-color {
      display: none;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      font-size: 14px;
  }

  .selected-color.visible {
      display: flex;
  }

  .color-preview {
      width: 24px;
      height: 24px;
      border: 1px solid #ccc;
      border-radius: 4px;
  }

  .grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 8px;
  }

  .color-box {
      aspect-ratio: 1;
      border: 1px solid #ccc;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
  }

  .color-box:hover {
      transform: scale(1.1);
  }

  .color-box::before {
      content: attr(data-color);
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.2s;
  }

  .color-box:hover::before {
      opacity: 1;
  }

  .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #333;
      color: white;
      border-radius: 4px;
      opacity: 0;
      transition: opacity 0.3s;
  }

  .notification.visible {
      opacity: 1;
  }
</style>

<body class="h-screen antialiased bg-custom-bg text-center">
  <div class="controls">
    <input type="color" id="colorPicker" value="#FF5733">
    <span id="hexValue">#FF5733</span>
  </div>

  <div class="selected-color" id="selectedColor">
      <div class="color-preview" id="selectedPreview"></div>
      <span id="selectedHex"></span>
  </div>

  <div id="colorGrid" class="grid"></div>

  <div class="notification" id="notification">Color copied to clipboard!</div>
</body>

<script>
// Color conversion functions from previous artifact
function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return [r, g, b];
}

function rgbToXyz(rgb) {
    let [r, g, b] = rgb.map(val => {
        val = val / 255;
        return val > 0.04045 ? Math.pow(((val + 0.055) / 1.055), 2.4) : val / 12.92;
    });

    r *= 100;
    g *= 100;
    b *= 100;

    const x = r * 0.4124 + g * 0.3576 + b * 0.1805;
    const y = r * 0.2126 + g * 0.7152 + b * 0.0722;
    const z = r * 0.0193 + g * 0.1192 + b * 0.9505;

    return [x, y, z];
}

function xyzToLab(xyz) {
    const [x, y, z] = xyz;
    const xn = 95.047;
    const yn = 100.000;
    const zn = 108.883;

    const fx = x / xn > 0.008856 ? Math.pow(x / xn, 1/3) : (7.787 * x / xn) + 16/116;
    const fy = y / yn > 0.008856 ? Math.pow(y / yn, 1/3) : (7.787 * y / yn) + 16/116;
    const fz = z / zn > 0.008856 ? Math.pow(z / zn, 1/3) : (7.787 * z / zn) + 16/116;

    const L = (116 * fy) - 16;
    const a = 500 * (fx - fy);
    const b = 200 * (fy - fz);

    return [L, a, b];
}

function labToXyz(lab) {
    const [L, a, b] = lab;
    const xn = 95.047;
    const yn = 100.000;
    const zn = 108.883;

    const fy = (L + 16) / 116;
    const fx = a / 500 + fy;
    const fz = fy - b / 200;

    const fx3 = Math.pow(fx, 3);
    const fz3 = Math.pow(fz, 3);

    const x = xn * (fx3 > 0.008856 ? fx3 : (fx - 16/116) / 7.787);
    const y = yn * (Math.pow((L + 16) / 116, 3) > 0.008856 ? Math.pow((L + 16) / 116, 3) : L / 903.3);
    const z = zn * (fz3 > 0.008856 ? fz3 : (fz - 16/116) / 7.787);

    return [x, y, z];
}

function xyzToRgb(xyz) {
    const [x, y, z] = xyz.map(v => v / 100);

    let r = x * 3.2406 + y * -1.5372 + z * -0.4986;
    let g = x * -0.9689 + y * 1.8758 + z * 0.0415;
    let b = x * 0.0557 + y * -0.2040 + z * 1.0570;

    r = r > 0.0031308 ? 1.055 * Math.pow(r, 1/2.4) - 0.055 : 12.92 * r;
    g = g > 0.0031308 ? 1.055 * Math.pow(g, 1/2.4) - 0.055 : 12.92 * g;
    b = b > 0.0031308 ? 1.055 * Math.pow(b, 1/2.4) - 0.055 : 12.92 * b;

    return [
        Math.round(Math.max(0, Math.min(255, r * 255))),
        Math.round(Math.max(0, Math.min(255, g * 255))),
        Math.round(Math.max(0, Math.min(255, b * 255)))
    ];
}

function rgbToHex(rgb) {
    return '#' + rgb.map(x => {
        const hex = x.toString(16);
        return hex.length === 1 ? '0' + hex : hex;
    }).join('');
}

function generateIsoLightnessColors(inputHex, numColors = 100) {
    const rgb = hexToRgb(inputHex);
    const xyz = rgbToXyz(rgb);
    const [L, ,] = xyzToLab(xyz);
    
    const colors = [];
    const range = 128;
    
    for (let i = 0; i < numColors; i++) {
        const angle = (i / numColors) * 2 * Math.PI;
        const radius = range;
        
        const a = Math.cos(angle) * radius;
        const b = Math.sin(angle) * radius;
        
        const newXyz = labToXyz([L, a, b]);
        const newRgb = xyzToRgb(newXyz);
        
        if (!newRgb.some(v => isNaN(v))) {
            const newHex = rgbToHex(newRgb);
            if (!colors.includes(newHex)) {
                colors.push(newHex);
            }
        }
    }
    
    return colors;
}

// UI handling code
const colorPicker = document.getElementById('colorPicker');
const hexValue = document.getElementById('hexValue');
const colorGrid = document.getElementById('colorGrid');
const selectedColor = document.getElementById('selectedColor');
const selectedPreview = document.getElementById('selectedPreview');
const selectedHex = document.getElementById('selectedHex');
const notification = document.getElementById('notification');

function showNotification() {
    notification.classList.add('visible');
    setTimeout(() => {
        notification.classList.remove('visible');
    }, 2000);
}

function updateGrid(color) {
    hexValue.textContent = color;
    colorGrid.innerHTML = '';
    
    const colors = generateIsoLightnessColors(color);
    
    colors.forEach(hex => {
        const box = document.createElement('div');
        box.className = 'color-box';
        box.style.backgroundColor = hex;
        box.setAttribute('data-color', hex);
        
        box.addEventListener('click', () => {
            navigator.clipboard.writeText(hex);
            selectedColor.classList.add('visible');
            selectedPreview.style.backgroundColor = hex;
            selectedHex.textContent = `${hex} (copied to clipboard)`;
            showNotification();
        });
        
        colorGrid.appendChild(box);
    });
}

colorPicker.addEventListener('input', (e) => {
    updateGrid(e.target.value);
});

// Initial render
updateGrid(colorPicker.value);
</script>